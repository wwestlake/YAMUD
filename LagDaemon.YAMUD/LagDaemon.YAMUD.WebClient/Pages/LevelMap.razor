@page "/levelmap"
@using LagDaemon.YAMUD.API.Services
@using LagDaemon.YAMUD.Model.Map

<div class="filters">
    <!-- Add filter UI components here -->
    <select @bind="selectedLevel">
        <option value="1">Level 1</option>
        <option value="2">Level 2</option>
        <!-- Add more options as needed -->
    </select>
    <button @onclick="LoadRooms">Apply Filters</button>
</div>

<div class="map">
    @foreach (var room in Rooms)
    {
        <div class="room" style="left: @(room.X * squareSize)px; top: @(room.Y * squareSize)px;"
             @onclick="() => ShowRoomDetails(room)" @onmouseover="() => ShowRoomDescription(room)">
            <!-- Display a square representing the room -->
        </div>
    }
</div>

@code {
    int squareSize = 50; // Adjust size as needed
    IEnumerable<Room> Rooms = new List<Room>(); // Initialize empty list
    int selectedLevel = 1; // Default level selection

    [Inject]
    private IMongoRoomService? RoomService { get; set; } // Inject your MongoDB service

    protected override async Task OnInitializedAsync()
    {
        await LoadRooms(); // Load rooms when the component initializes
    }

    private async Task LoadRooms()
    {
        // Query MongoDB service to fetch rooms based on the selected level
        Rooms = await RoomService?.GetRoomsByLevel(selectedLevel);
    }

    void ShowRoomDetails(Room room)
    {
        // Navigate to a page showing room details
        // Example: NavigationManager.NavigateTo($"/roomdetails/{room.X}/{room.Y}/{room.Z}");
    }

    void ShowRoomDescription(Room room)
    {
        // Display room description (e.g., in a tooltip or popover)
        // Example: BlazoredTooltipService.Show(room.Description);
    }
}
